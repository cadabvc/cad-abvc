<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CAD ABVC - Conselho de Arbitragem</title>

<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.28.0/dist/supabase.min.js"></script>

<style>
:root{
    --accent:#000; /* header preto */
}

body{
    margin:0;
    font-family: Arial, sans-serif;
    background:#fff;
    color:#000;
}

/* HEADER */
header{
    background:var(--accent);
    padding:10px;
    text-align:center;
}
header img{
    max-width:200px;
    height:auto;
}

/* MENU */
nav{
    display:flex;
    justify-content:center;
    gap:1rem;
    background:#222;
    flex-wrap:wrap;
}
nav a{
    color:#fff;
    text-decoration:none;
    padding:1rem;
    font-weight:bold;
    cursor:pointer;
}

/* SE√á√ïES */
section{
    display:none;
    padding:1rem;
}
section.active{
    display:block;
}

/* HOME FOTO */
.home-img{
    width:100%;
    max-height:none;
    object-fit:contain;
    margin-top:10px;
}

/* FORM */
form{
    background:#f8f8f8;
    padding:1rem;
    border-radius:8px;
    margin-bottom:1rem;
}
label{ display:block; margin-top:0.5rem; }
input,select,textarea{
    width:100%;
    padding:0.5rem;
    margin-top:0.3rem;
}
button{
    margin-top:0.7rem;
    padding:0.7rem 1rem;
    background:var(--accent);
    color:white;
    border:none;
    cursor:pointer;
    font-weight:bold;
}

/* TABELAS */
table{
    width:100%;
    border-collapse:collapse;
}
th,td{
    border:1px solid #ccc;
    padding:0.5rem;
    text-align:center;
}
.total{ font-weight:bold; }

/* FOOTER */
footer{
    background:#000;
    color:#fff;
    padding:0.7rem;
    display:flex;
    justify-content:space-between;
    font-size:0.9rem;
}
footer a{ color:#fff; text-decoration:none; }

/* MOBILE */
@media(max-width:600px){
    nav{ flex-direction:column; }
    table, thead, tbody, th, td, tr{
        display:block;
    }
    tr{
        margin-bottom:12px;
        border:1px solid #ddd;
    }
    td{
        border:none;
        text-align:left;
        padding-left:45%;
        position:relative;
    }
    td::before{
        content:attr(data-label);
        position:absolute;
        left:0;
        width:40%;
        padding-left:10px;
        font-weight:bold;
    }
}
</style>
</head>

<body>

<header>
    <img src="abvc_cad.png">
</header>

<nav>
<a onclick="showSection('home')">Home</a>
<a onclick="showSection('dispensas')">Dispensas</a>
<a onclick="showSection('recibos')">Recibos</a>
<a onclick="showSection('comunicados')">Comunicados</a>
<a onclick="showSection('calendario')">Calend√°rio ABVC</a>
<a onclick="showSection('contactos')">Contactos</a>
</nav>

<!-- HOME -->
<section id="home" class="active">
    <img src="abvc_cad.png" class="home-img">
    <h2>Bem-vindo ao CAD da ABVC</h2>
</section>

<!-- DISPENSAS -->
<section id="dispensas">
<h2>Registo de Dispensas</h2>

<form id="dispensaForm">
<label>Nome:</label>
<input type="text" id="nomeDispensa" required>

<label>Data Inicial:</label>
<input type="date" id="dataInicio" required>

<label>Data Final:</label>
<input type="date" id="dataFim" required>

<label>Per√≠odo:</label>
<select id="periodo" required>
    <option value="Integral">Integral</option>
    <option value="Manh√£">Parte da Manh√£</option>
    <option value="Tarde">Parte da Tarde</option>
    <option value="Noite">Parte da Noite</option>
</select>

<label>Motivo:</label>
<textarea id="motivo"></textarea>

<button type="button" onclick="enviarDispensa()">Enviar Dispensa</button>
</form>

<div id="listaDispensas"></div>
</section>
<!-- RECIBOS -->
<section id="recibos">
<h2>Submiss√£o de Recibos</h2>

<form id="reciboForm">
<label>N¬∫ do Jogo:</label>
<input type="text" id="numeroJogo" required>

<table>
<thead>
<tr>
<th>Cargo</th>
<th>Nome</th>
<th>Pr√©mio (‚Ç¨)</th>
<th>Desloca√ß√£o (‚Ç¨)</th>
<th>Diversos (‚Ç¨)</th>
<th>Total (‚Ç¨)</th>
</tr>
</thead>

<tbody id="tabelaRecibos">
<tr>
<td data-label="Cargo">√Årbitro Principal</td>
<td data-label="Nome"><input type="text" class="nome"></td>
<td data-label="Pr√©mio"><input type="text" class="premio"></td>
<td data-label="Desloca√ß√£o"><input type="text" class="deslocacao"></td>
<td data-label="Diversos"><input type="text" class="diversos"></td>
<td data-label="Total" class="total">0,00</td>
</tr>

<tr>
<td data-label="Cargo">√Årbitro Auxiliar</td>
<td><input type="text" class="nome"></td>
<td><input type="text" class="premio"></td>
<td><input type="text" class="deslocacao"></td>
td><input type="text" class="diversos"></td>
<td class="total">0,00</td>
</tr>

<tr>
<td data-label="Cargo">Marcador</td>
<td><input type="text" class="nome"></td>
<td><input type="text" class="premio"></td>
<td><input type="text" class="deslocacao"></td>
<td><input type="text" class="diversos"></td>
<td class="total">0,00</td>
</tr>

<tr>
<td data-label="Cargo">Operador 24"</td>
<td><input type="text" class="nome"></td>
<td><input type="text" class="premio"></td>
<td><input type="text" class="deslocacao"></td>
<td><input type="text" class="diversos"></td>
<td class="total">0,00</td>
</tr>

<tr>
<td data-label="Cargo">Cronometrista</td>
<td><input type="text" class="nome"></td>
<td><input type="text" class="premio"></td>
<td><input type="text" class="deslocacao"></td>
<td><input type="text" class="diversos"></td>
<td class="total">0,00</td>
</tr>
</tbody>
</table>

<h3>Total Geral (‚Ç¨): <span id="totalGeral">0,00</span></h3>

<label>Upload Recibo (PDF ou Imagem):</label>
<input type="file" id="ficheiroRecibo" accept=".jpg,.png,.jpeg,.pdf">

<button type="button" onclick="enviarRecibo()">Enviar Recibo</button>
</form>

</section>

<!-- COMUNICADOS -->
<section id="comunicados">
<h2>Comunicados</h2>
<div id="listaComunicados">Em breve...</div>
</section>

<!-- CALEND√ÅRIO -->
<section id="calendario">
<h2>Calend√°rio ABVC</h2>
<iframe src="https://www.fpb.pt/calendario/associacao_17/?associacao=17&epoca=2025/2026"
style="width:100%;height:600px;border:none;"></iframe>
</section>

<!-- CONTACTOS -->
<section id="contactos">
<h2>Contactos</h2>

<p><a href="https://wa.me/351926166077" target="_blank">üìû Enviar WhatsApp</a></p>

<form id="emailForm">
<label>Seu Email:</label>
<input type="email" id="emailRemetente">

<label>Assunto:</label>
<input type="text" id="assuntoEmail">

<label>Mensagem:</label>
<textarea id="mensagemEmail"></textarea>

<button type="button" onclick="enviarEmail()">Enviar Email</button>
</form>
</section>

<footer>
<span>R. Conselheiro Arnaldo Norton de Matos 31, 4990-081 Pte. de Lima</span>
<span><a href="admin.html">Admin</a></span>
</footer>

<script>
// ----------------------------
// CONFIG SUPABASE
// ----------------------------
const supabaseUrl = "https://prwhifyewscielsopluj.supabase.co";
const supabaseKey =
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InByd2hpZnlld3NjaWVsc29wbHVqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwMzA2MzEsImV4cCI6MjA3ODYwNjYzMX0.N8Op_2iUwRFd71YTninoztaInQtVLEnVIwbi2nIHkKg";

const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

// ----------------------------
// SE√á√ïES
// ----------------------------
function showSection(id){
    document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
}

// ----------------------------
// C√ÅLCULO DOS RECIBOS
// ----------------------------
function atualizarTotais(){
    let totalGeral = 0;

    document.querySelectorAll("#tabelaRecibos tr").forEach(row=>{
        const premio = parseFloat((row.querySelector(".premio")?.value || "0").replace(",", ".")) || 0;
        const desloc = parseFloat((row.querySelector(".deslocacao")?.value || "0").replace(",", ".")) || 0;
        const diversos = parseFloat((row.querySelector(".diversos")?.value || "0").replace(",", ".")) || 0;

        const total = premio + desloc + diversos;

        if(row.querySelector(".total")){
            row.querySelector(".total").textContent = total.toFixed(2).replace(".", ",");
        }
        totalGeral += total;
    });

    document.getElementById("totalGeral").textContent =
        totalGeral.toFixed(2).replace(".", ",");
}

// EVENTOS DE INPUT
document.querySelectorAll(".premio, .deslocacao, .diversos").forEach(inp=>{
    inp.addEventListener("input", atualizarTotais);
});

// ----------------------------
// ENVIAR DISPENSA
// ----------------------------
async function enviarDispensa(){
    const nome = document.getElementById("nomeDispensa").value;
    const dataInicio = document.getElementById("dataInicio").value;
    const dataFim = document.getElementById("dataFim").value;
    const periodo = document.getElementById("periodo").value;
    const motivo = document.getElementById("motivo").value;

    if(!nome || !dataInicio || !dataFim){
        alert("Preencha todos os campos obrigat√≥rios.");
        return;
    }

    const { error } = await supabaseClient.from("dispensas").insert([{
        nome, data_inicio: dataInicio, data_fim: dataFim, periodo, motivo
    }]);

    if(error){
        alert("Erro ao enviar: " + error.message);
        return;
    }

    alert("Dispensa enviada com sucesso!");
    document.getElementById("dispensaForm").reset();
}

// ----------------------------
// ENVIAR RECIBO
// ----------------------------
async function enviarRecibo(){
    const numeroJogo = document.getElementById("numeroJogo").value;

    if(!numeroJogo){
        alert("Insira o n√∫mero do jogo.");
        return;
    }

    const linhas = document.querySelectorAll("#tabelaRecibos tr");

    const arbitros = [...linhas].map(l=>({
        cargo: l.children[0].innerText,
        nome: l.querySelector(".nome").value,
        premio: l.querySelector(".premio").value,
        deslocacao: l.querySelector(".deslocacao").value,
        diversos: l.querySelector(".diversos").value,
        total: l.querySelector(".total").innerText,
    }));

    // Upload ficheiro
    let ficheiroUrl = null;
    const ficheiro = document.getElementById("ficheiroRecibo").files[0];

    if(ficheiro){
        const path = `public/${Date.now()}_${ficheiro.name}`;

        const { error: uploadErr } = await supabaseClient
            .storage.from("recibos")
            .upload(path, ficheiro);

        if(uploadErr){
            alert("Erro no upload: " + uploadErr.message);
            return;
        }

        const { data } = supabaseClient.storage.from("recibos").getPublicUrl(path);
        ficheiroUrl = data.publicUrl;
    }

    const { error } = await supabaseClient.from("recibos").insert([{
        numero_jogo: numeroJogo,
        arbitros,
        ficheiro_url: ficheiroUrl
    }]);

    if(error){
        alert("Erro ao enviar: " + error.message);
        return;
    }

    alert("Recibo enviado com sucesso!");
    document.getElementById("reciboForm").reset();
    atualizarTotais();
}

// ----------------------------
// EMAIL
// ----------------------------
function enviarEmail(){
    const email = document.getElementById("emailRemetente").value;
    const assunto = document.getElementById("assuntoEmail").value;
    const msg = document.getElementById("mensagemEmail").value;

    window.location.href =
        `mailto:arbitragem.abvc@gmail.com?subject=${encodeURIComponent(assunto)}&body=${encodeURIComponent("De: "+email+"\n\n"+msg)}`;
}

</script>

</body>
</html>
