<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AB Viana do Castelo - Conselho de Arbitragem</title>
<style>
  body { margin:0; font-family: Arial, sans-serif; background: #fff; color: #000; }

  /* Header inicial */
  #header-inicial { width:100%; text-align:center; margin-top:0; }
  #header-inicial img { width:100%; height:auto; max-height:none; display:block; }
  #header-inicial h1 { margin:0.5rem 0; }

  /* Menu superior */
  nav { display:flex; justify-content:center; background:#ccc; }
  nav ul { list-style:none; margin:0; padding:0; display:flex; width:100%; justify-content:center; }
  nav li { margin:0 1rem; }
  nav a { text-decoration:none; color:#000; font-weight:bold; padding:1rem; display:block; }
  nav a:hover { background:#aaa; color:#fff; border-radius:4px; }

  /* Seções */
  section { display:none; padding:1rem; max-width:1200px; margin:0 auto; }
  section.active { display:block; }

  table { width:100%; border-collapse: collapse; margin-top:1rem; }
  th, td { border:1px solid #ddd; padding:0.5rem; text-align:center; }
  th { background:#ccc; }

  footer { text-align:center; padding:1rem; background:#eee; position:fixed; bottom:0; width:100%; }
  footer a { text-decoration:none; font-weight:bold; color:#000; }
</style>
</head>
<body>

<nav>
  <ul>
    <li><a href="#" onclick="abrirSecao('dispensas')">Comunicação de Dispensas</a></li>
    <li><a href="#" onclick="abrirSecao('recibos')">Recibos de Jogo</a></li>
    <li><a href="#" onclick="abrirSecao('comunicados')">Comunicados</a></li>
    <li><a href="#" onclick="abrirSecao('calendario')">Calendário ABVC</a></li>
  </ul>
</nav>

<header id="header-inicial">
  <img src="abvc_cad.png" alt="AB Viana do Castelo Logo">
  <h1>AB Viana do Castelo - Conselho de Arbitragem</h1>
</header>

<!-- DISPENSAS -->
<section id="dispensas">
  <h2>Registo de Dispensas</h2>
  <form id="dispensaForm">
    <label>Nome:</label>
    <input type="text" id="nomeDispensa" required>
    <label>Data:</label>
    <input type="date" id="dataDispensa" required>
    <label>Período:</label>
    <select id="periodoDispensa" required>
      <option value="Integral">Integral</option>
      <option value="Manhã">Parte da Manhã</option>
      <option value="Tarde">Parte da Tarde</option>
      <option value="Noite">Parte da Noite</option>
    </select>
    <label>Motivo (opcional):</label>
    <textarea id="motivoDispensa" rows="3"></textarea>
    <button type="button" onclick="guardarDispensa()">Guardar</button>
    <button type="button" onclick="exportarDispensas()">Exportar CSV</button>
  </form>
  <div id="listaDispensas"></div>
</section>

<!-- RECIBOS -->
<section id="recibos">
  <h2>Submissão de Recibos</h2>
  <form id="reciboForm">
    <label>Nº do Jogo:</label>
    <input type="text" id="numeroJogo" required>
    <h3>Equipa de Arbitragem</h3>
    <table>
      <thead>
        <tr>
          <th>Função</th>
          <th>Nome</th>
          <th>Prémio (€)</th>
          <th>Deslocação (€)</th>
          <th>Diversos (€)</th>
          <th>Total (€)</th>
        </tr>
      </thead>
      <tbody>
        <tr><td>Árbitro Principal</td><td><input type="text" class="nome"></td><td><input type="number" class="premio" min="0" step="0.01"></td><td><input type="number" class="deslocacao" min="0" step="0.01"></td><td><input type="number" class="diversos" min="0" step="0.01"></td><td class="total">0.00</td></tr>
        <tr><td>Árbitro Auxiliar</td><td><input type="text" class="nome"></td><td><input type="number" class="premio" min="0" step="0.01"></td><td><input type="number" class="deslocacao" min="0" step="0.01"></td><td><input type="number" class="diversos" min="0" step="0.01"></td><td class="total">0.00</td></tr>
        <tr><td>Marcador</td><td><input type="text" class="nome"></td><td><input type="number" class="premio" min="0" step="0.01"></td><td><input type="number" class="deslocacao" min="0" step="0.01"></td><td><input type="number" class="diversos" min="0" step="0.01"></td><td class="total">0.00</td></tr>
        <tr><td>Operador 24"</td><td><input type="text" class="nome"></td><td><input type="number" class="premio" min="0" step="0.01"></td><td><input type="number" class="deslocacao" min="0" step="0.01"></td><td><input type="number" class="diversos" min="0" step="0.01"></td><td class="total">0.00</td></tr>
        <tr><td>Cronometrista</td><td><input type="text" class="nome"></td><td><input type="number" class="premio" min="0" step="0.01"></td><td><input type="number" class="deslocacao" min="0" step="0.01"></td><td><input type="number" class="diversos" min="0" step="0.01"></td><td class="total">0.00</td></tr>
      </tbody>
    </table>
    <h3>Total Geral (€): <span id="totalGeral">0.00</span></h3>
    <label>Upload do Recibo (PDF ou imagem):</label>
    <input type="file" id="ficheiroRecibo" accept=".pdf,.jpg,.png">
    <button type="button" onclick="guardarRecibo()">Guardar Recibo</button>
    <button type="button" onclick="exportarRecibos()">Exportar CSV</button>
  </form>
  <div id="listaRecibos"></div>
</section>

<!-- COMUNICADOS -->
<section id="comunicados">
  <h2>Comunicados</h2>
  <div id="listaComunicados"></div>
</section>

<!-- CALENDÁRIO -->
<section id="calendario">
  <h2>Calendário ABVC</h2>
  <iframe src="https://www.fpb.pt/calendario/associacao_17/?associacao=17&epoca=2025/2026&" style="width:100%; height:800px; border:none;"></iframe>
</section>

<footer>
  <a href="admin.html">Admin</a>
</footer>

<script>
// Controla seções e header inicial
function abrirSecao(secaoId) {
  const header = document.getElementById('header-inicial');
  const sections = document.querySelectorAll('section');
  sections.forEach(s => {
    if(s.id === secaoId) s.classList.add('active');
    else s.classList.remove('active');
  });
  header.style.display = 'none';
}
function mostrarHeaderInicial() {
  const header = document.getElementById('header-inicial');
  document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
  header.style.display = 'block';
}

// DISPENSAS
const dispList = JSON.parse(localStorage.getItem('dispensas')||'[]');
renderDispensas();
function guardarDispensa(){
  const nome = document.getElementById('nomeDispensa').value;
  const data = document.getElementById('dataDispensa').value;
  const periodo = document.getElementById('periodoDispensa').value;
  const motivo = document.getElementById('motivoDispensa').value;
  dispList.push({nome,data,periodo,motivo});
  localStorage.setItem('dispensas', JSON.stringify(dispList));
  renderDispensas();
  alert('Dispensa registada com sucesso!');
}
function renderDispensas(){
  const div = document.getElementById('listaDispensas');
  if(dispList.length===0){ div.innerHTML='Nenhuma dispensa registada.'; return; }
  div.innerHTML = '<table><tr><th>Nome</th><th>Data</th><th>Período</th><th>Motivo</th></tr>'+dispList.map(d=>`<tr><td>${d.nome}</td><td>${d.data}</td><td>${d.periodo}</td><td>${d.motivo}</td></tr>`).join('')+'</table>';
}
function exportarDispensas(){
  const csv = 'Nome,Data,Período,Motivo\n'+dispList.map(d=>`${d.nome},${d.data},${d.periodo},${d.motivo}`).join('\n');
  const blob = new Blob([csv], {type:'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.click();
}

// RECIBOS
const recList = JSON.parse(localStorage.getItem('recibos')||'[]');
const tbody = document.querySelectorAll('#recibos tbody')[0];
tbody.querySelectorAll('input').forEach(inp=>inp.addEventListener('input', atualizarTotais));
function atualizarTotais(){
  let totalGeral = 0;
  [...tbody.rows].forEach(r=>{
    const premio=parseFloat(r.querySelector('.premio').value)||0;
    const desloc=parseFloat(r.querySelector('.deslocacao').value)||0;
    const diversos=parseFloat(r.querySelector('.diversos').value)||0;
    const total=premio+desloc+diversos;
    r.querySelector('.total').textContent = total.toFixed(2);
    totalGeral+=total;
  });
  document.getElementById('totalGeral').textContent = totalGeral.toFixed(2);
}
function guardarRecibo(){
  const numeroJogo=document.getElementById('numeroJogo').value;
  const ficheiro=document.getElementById('ficheiroRecibo').files[0];
  const arbitros=[...tbody.rows].map(r=>({
    nome:r.querySelector('.nome').value,
    premio:r.querySelector('.premio').value,
    deslocacao:r.querySelector('.deslocacao').value,
    diversos:r.querySelector('.diversos').value,
    total:r.querySelector('.total').textContent
  }));
  const reader=new FileReader();
  reader.onload=()=>{
    recList.push({numeroJogo,arbitros,ficheiro:reader.result});
    localStorage.setItem('recibos', JSON.stringify(recList));
    alert('Recibo guardado com sucesso!');
  };
  if(ficheiro) reader.readAsDataURL(ficheiro); else reader.onload();
}
function exportarRecibos(){
  let csv='Nº Jogo,Nome,Prémio,Deslocação,Diversos,Total\n';
  recList.forEach(r=>{
    r.arbitros.forEach(a=>{
      csv+=`${r.numeroJogo},${a.nome},${a.premio},${a.deslocacao},${a.diversos},${a.total}\n`;
    });
  });
  const blob=new Blob([csv],{type:'text/csv'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='recibos.csv'; a.click();
}

// COMUNICADOS
const comunicados=JSON.parse(localStorage.getItem('comunicados')||'[]');
renderComunicados();
function renderComunicados(){
  const div=document.getElementById('listaComunicados');
  if(comunicados.length===0){ div.innerHTML='Nenhum comunicado disponível.'; return; }
  div.innerHTML = comunicados.map(c=>`<div style='background:#fff;padding:1rem;margin:.5rem 0;border-radius:8px;box-shadow:0 0 5px #ccc;'><h4>${c.titulo}</h4><p>${c.mensagem}</p><small>${c.data}</small></div>`).join('');
}
</script>

</body>
</html>
