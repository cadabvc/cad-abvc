        <ul>`;
      r.arbitros.forEach(a=>{
        html+=`<li>${escapeHtml(a.cargo)}: ${escapeHtml(a.nome)} | Prémio: ${a.premio.toFixed(2).replace('.',',')} € | Deslocação: ${a.desloc.toFixed(2).replace('.',',')} € | Diversos: ${a.diversos.toFixed(2).replace('.',',')} € | Total: ${a.total.toFixed(2).replace('.',',')} €</li>`;
      });
      html+='</ul></div>';
    });
    div.innerHTML=html;
  }catch(e){ console.error(e); document.getElementById('listaRecibos').innerHTML='<p>Erro ao carregar recibos.</p>'; }
}

/* ---------- COMUNICADOS ---------- */
async function carregarComunicados(){
  try{
    const { data, error } = await supabase.from('comunicados').select('*').order('id',{ascending:false});
    if(error) throw error;
    const div=document.getElementById('listaComunicados');
    if(!data||data.length===0){ div.innerHTML='<p>Sem comunicados.</p>'; return; }
    let html='<ul>';
    data.forEach(c=>{
      html+=`<li><strong>${escapeHtml(c.titulo)}</strong>: ${escapeHtml(c.mensagem)}</li>`;
    });
    html+='</ul>';
    div.innerHTML=html;
  }catch(e){ console.error(e); document.getElementById('listaComunicados').innerHTML='<p>Erro ao carregar comunicados.</p>'; }
}

/* ---------- UTIL ---------- */
function escapeHtml(text){
  if(!text) return '';
  return text.replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
}

/* ---------- EMAIL SIMULADO ---------- */
function enviarEmail(){
  const email=document.getElementById('emailRemetente').value.trim();
  const assunto=document.getElementById('assuntoEmail').value.trim();
  const mensagem=document.getElementById('mensagemEmail').value.trim();
  if(!email||!assunto||!mensagem){ alert('Preencha todos os campos.'); return; }
  alert('Mensagem simulada enviada!\n\n'+`De: ${email}\nAssunto: ${assunto}\nMensagem: ${mensagem}`);
}

/* ---------- Inicialização ---------- */
document.addEventListener('DOMContentLoaded', ()=>{
  carregarListaDispensas();
  carregarListaRecibos();
  carregarComunicados();
});
</script>

</body>
</html>
