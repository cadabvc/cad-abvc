<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CAD ABVC - Conselho de Arbitragem de Viana do Castelo</title>
<style>
body { margin:0; font-family: Arial, sans-serif; background:#fff; color:#000;}
nav { display:flex; justify-content:center; gap:1rem; background:#444; }
nav a { color:#fff; text-decoration:none; font-weight:bold; padding:1rem; cursor:pointer;}
section { display:none; padding:1rem; }
section.active { display:block; }
.home-img { width:100%; max-height:none; object-fit:contain; margin-top:10px; }
form { background:#f8f8f8; padding:1rem; border-radius:8px; margin-bottom:1rem; }
label { display:block; margin-top:0.5rem; }
input, select, textarea { width:100%; padding:0.5rem; margin-top:0.3rem; }
button { margin-top:0.5rem; padding:0.5rem 1rem; cursor:pointer; }
table { width:100%; border-collapse: collapse; table-layout: fixed; }
th, td { border:1px solid #ccc; padding:0.5rem; text-align:center; word-wrap:break-word;}
.total { font-weight:bold; }
footer { background:#333; color:#fff; padding:0.5rem 1rem; display:flex; justify-content:space-between; align-items:center; font-size:0.9rem;}
footer a { color:#fff; text-decoration:none; }
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.28.0/dist/supabase.min.js"></script>
</head>
<body>

<nav>
<a onclick="showSection('home')">Home</a>
<a onclick="showSection('dispensas')">Dispensas</a>
<a onclick="showSection('recibos')">Recibos</a>
<a onclick="showSection('comunicados')">Comunicados</a>
<a onclick="showSection('calendario')">Calendário ABVC</a>
<a onclick="showSection('contactos')">Contactos</a>
</nav>

<section id="home" class="active">
<img src="cad_abvc.png" alt="AB Viana do Castelo" class="home-img">
<h2>Bem-vindo ao CAD da ABVC</h2>

</section>

<section id="dispensas">
<h2>Registo de Dispensas</h2>
<form id="dispensaForm">
<label>Nome:</label><input type="text" id="nomeDispensa" required>
<label>Data:</label><input type="date" id="dataDispensa" required>
<label>Período:</label>
<select id="periodoDispensa" required>
<option value="Integral">Integral</option>
<option value="Manhã">Parte da Manhã</option>
<option value="Tarde">Parte da Tarde</option>
<option value="Noite">Parte da Noite</option>
</select>
<label>Motivo:</label><textarea id="motivoDispensa"></textarea>
<button type="button" onclick="enviarDispensa()">Enviar Dispensa</button>
</form>
<div id="listaDispensas"></div>
</section>

<section id="recibos">
<h2>Submissão de Recibos</h2>
<form id="reciboForm">
<label>Nº do Jogo:</label><input type="text" id="numeroJogo" required>
<table>
<tr><th>Cargo</th><th>Nome</th><th>Prémio (€)</th><th>Deslocação (€)</th><th>Diversos (€)</th><th>Total (€)</th></tr>
<tr><td>Árbitro Principal</td><td><input type="text" class="nome"></td><td><input type="text" class="premio"></td><td><input type="text" class="deslocacao"></td><td><input type="text" class="diversos"></td><td class="total">0,00</td></tr>
<tr><td>Árbitro Auxiliar</td><td><input type="text" class="nome"></td><td><input type="text" class="premio"></td><td><input type="text" class="deslocacao"></td><td><input type="text" class="diversos"></td><td class="total">0,00</td></tr>
<tr><td>Marcador</td><td><input type="text" class="nome"></td><td><input type="text" class="premio"></td><td><input type="text" class="deslocacao"></td><td><input type="text" class="diversos"></td><td class="total">0,00</td></tr>
<tr><td>Operador 24"</td><td><input type="text" class="nome"></td><td><input type="text" class="premio"></td><td><input type="text" class="deslocacao"></td><td><input type="text" class="diversos"></td><td class="total">0,00</td></tr>
<tr><td>Cronometrista</td><td><input type="text" class="nome"></td><td><input type="text" class="premio"></td><td><input type="text" class="deslocacao"></td><td><input type="text" class="diversos"></td><td class="total">0,00</td></tr>
</table>
<h3>Total Geral (€): <span id="totalGeral">0,00</span></h3>
<label>Upload Recibo (PDF ou Imagem):</label>
<input type="file" id="ficheiroRecibo">
<button type="button" onclick="enviarRecibo()">Enviar Recibo</button>
</form>
<div id="listaRecibos"></div>
</section>

<section id="comunicados">
<h2>Comunicados</h2>
<div id="listaComunicados"></div>
</section>

<section id="calendario">
<h2>Calendário ABVC</h2>
<iframe src="https://www.fpb.pt/calendario/associacao_17/?associacao=17&epoca=2025/2026" style="width:100%;height:600px;border:none;"></iframe>
</section>

<section id="contactos">
<h2>Contactos</h2>
<p><a href="https://wa.me/351926166077" target="_blank">Enviar WhatsApp</a></p>
<form id="emailForm">
<label>Seu Email:</label><input type="email" id="emailRemetente">
<label>Assunto:</label><input type="text" id="assuntoEmail">
<label>Mensagem:</label><textarea id="mensagemEmail"></textarea>
<button type="button" onclick="enviarEmail()">Enviar Email</button>
</form>
</section>

<footer>
<span>R. Conselheiro Arnaldo Norton de Matos 31, 4990-081 Pte. de Lima</span>
<span><a href="admin.html">Admin</a></span>
</footer>

<script>
// Supabase
const supabaseUrl = 'https://prwhifyewscielsopluj.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InByd2hpZnlld3NjaWVsc29wbHVqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwMzA2MzEsImV4cCI6MjA3ODYwNjYzMX0.N8Op_2iUwRFd71YTninoztaInQtVLEnVIwbi2nIHkKg';
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

function showSection(id){
document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
document.getElementById(id).classList.add('active');
}

// Atualizar totais com vírgula
function atualizarTotais(){
let totalGeral=0;
const rows=document.querySelectorAll('#recibos table tr');
rows.forEach((r,i)=>{
if(i===0) return;
const premio=parseFloat(r.querySelector('.premio').value.replace(',','.'))||0;
const desloc=parseFloat(r.querySelector('.deslocacao').value.replace(',','.'))||0;
const diversos=parseFloat(r.querySelector('.diversos').value.replace(',','.'))||0;
const total=premio+desloc+diversos;
r.querySelector('.total').textContent=total.toFixed(2).replace('.',',');
totalGeral+=total;
});
document.getElementById('totalGeral').textContent=totalGeral.toFixed(2).replace('.',',');
}

document.querySelectorAll('#recibos table tr').forEach((r,i)=>{
if(i===0) return;
['.premio','.deslocacao','.diversos'].forEach(cls=>{
r.querySelector(cls).addEventListener('input', atualizarTotais);
});
});

// Envio para Supabase
async function enviarDispensa(){
const nome=document.getElementById('nomeDispensa').value;
const data=document.getElementById('dataDispensa').value;
const periodo=document.getElementById('periodoDispensa').value;
const motivo=document.getElementById('motivoDispensa').value;
const { error } = await supabase.from('dispensa').insert([{nome,data,periodo,motivo}]);
if(error) alert('Erro ao enviar: '+error.message);
else alert('Dispensa enviada com sucesso!');
}

async function enviarRecibo(){
const numeroJogo=document.getElementById('numeroJogo').value;
const arbitros=[...document.querySelectorAll('#recibos table tr')].slice(1).map(r=>({
nome:r.querySelector('.nome').value,
premio:r.querySelector('.premio').value,
deslocacao:r.querySelector('.deslocacao').value,
diversos:r.querySelector('.diversos').value,
total:r.querySelector('.total').textContent
}));
const ficheiro=document.getElementById('ficheiroRecibo').files[0];
let ficheiroUrl=null;
if(ficheiro){
const { data, error } = await supabase.storage.from('recibos').upload('public/'+ficheiro.name, ficheiro);
if(error){ alert('Erro upload ficheiro: '+error.message); return;}
const { data: urlData } = supabase.storage.from('recibos').getPublicUrl('public/'+ficheiro.name);
ficheiroUrl=urlData.publicUrl;
}
const { error } = await supabase.from('recibos').insert([{numeroJogo,arbitros,ficheiroUrl}]);
if(error) alert('Erro ao enviar: '+error.message);
else alert('Recibo enviado com sucesso!');
}

// Envio de email
function enviarEmail(){
const email=document.getElementById('emailRemetente').value;
const assunto=document.getElementById('assuntoEmail').value;
const msg=document.getElementById('mensagemEmail').value;
window.location.href=`mailto:arbitragem.abvc@gmail.com?subject=${encodeURIComponent(assunto)}&body=${encodeURIComponent("De: "+email+"\n\n"+msg)}`;
}
</script>
</body>
</html>
