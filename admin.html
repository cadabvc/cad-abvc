<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin CAD ABVC</title>
<style>
body { margin:0; font-family: Arial, sans-serif; background:#fff; color:#000;}
header { background:#333; color:#fff; padding:1rem; text-align:center; }
h2 { margin-top:0; }
form { background:#f8f8f8; padding:1rem; border-radius:8px; margin-bottom:1rem; }
label { display:block; margin-top:0.5rem; }
input, select, textarea, button { width:100%; padding:0.5rem; margin-top:0.3rem; }
button { cursor:pointer; background:#333; color:#fff; border:none; border-radius:4px; }
table { width:100%; border-collapse:collapse; margin-top:1rem; table-layout: fixed; }
th, td { border:1px solid #ccc; padding:0.5rem; text-align:center; word-wrap:break-word; }
footer { background:#333; color:#fff; padding:0.5rem 1rem; font-size:0.9rem; text-align:right; }
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<header>
<h1>Admin CAD ABVC</h1>
</header>

<div id="loginDiv">
  <form id="loginForm">
    <label>Usuário:</label>
    <input type="text" id="adminUser">
    <label>Senha:</label>
    <input type="password" id="adminPass">
    <button type="button" onclick="loginAdmin()">Entrar</button>
  </form>
</div>

<div id="adminContent" style="display:none; padding:1rem;">
  <h2>Dispensas Submetidas</h2>
  <table id="dispensaTable">
    <thead>
      <tr><th>Nome</th><th>Data</th><th>Período</th><th>Motivo</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>Recibos Submetidos</h2>
  <table id="recibosTable">
    <thead>
      <tr><th>Nº Jogo</th><th>Cargo</th><th>Nome</th><th>Prémio (€)</th><th>Deslocação (€)</th><th>Diversos (€)</th><th>Total (€)</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<footer>Admin CAD ABVC</footer>

<script>
const supabaseUrl = "https://prwhifyewscielsopluj.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InByd2hpZnlld3NjaWVsc29wbHVqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwMzA2MzEsImV4cCI6MjA3ODYwNjYzMX0.N8Op_2iUwRFd71YTninoztaInQtVLEnVIwbi2nIHkKg";
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

const ADMIN_USER = "admin";
const ADMIN_PASS = "12345"; // Troque para senha segura

function loginAdmin() {
  const user = document.getElementById('adminUser').value;
  const pass = document.getElementById('adminPass').value;
  if(user===ADMIN_USER && pass===ADMIN_PASS){
    document.getElementById('loginDiv').style.display='none';
    document.getElementById('adminContent').style.display='block';
    carregarDados();
  } else {
    alert("Usuário ou senha incorretos");
  }
}

async function carregarDados(){
  // Carregar dispensas
  const { data: dispensas, error: dispError } = await supabase.from('dispensa').select('*');
  if(dispError){ console.error(dispError); return; }
  const tbodyDisp = document.querySelector('#dispensaTable tbody');
  tbodyDisp.innerHTML = '';
  dispensas.forEach(d=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${d.nome}</td><td>${d.data}</td><td>${d.periodo}</td><td>${d.motivo}</td>`;
    tbodyDisp.appendChild(tr);
  });

  // Carregar recibos
  const { data: recibos, error: recError } = await supabase.from('recibos').select('*');
  if(recError){ console.error(recError); return; }
  const tbodyRec = document.querySelector('#recibosTable tbody');
  tbodyRec.innerHTML = '';
  recibos.forEach(r=>{
    if(r.arbitros){
      r.arbitros.forEach(a=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${r.numeroJogo}</td><td>${a.cargo}</td><td>${a.nome}</td><td>${a.premio}</td><td>${a.deslocacao}</td><td>${a.diversos}</td><td>${a.total}</td>`;
        tbodyRec.appendChild(tr);
      });
    }
  });
}
</script>

</body>
</html>
