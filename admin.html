<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin CAD ABVC</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.28.0/dist/supabase.min.js"></script>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#fff;
    color:#000;
    padding:20px;
}

h2{ margin-top:0; }

form{
    background:#f1f1f1;
    padding:15px;
    border-radius:10px;
    max-width:400px;
}

input{
    width:100%;
    padding:10px;
    margin-top:5px;
}

button{
    padding:10px 20px;
    margin-top:10px;
    cursor:pointer;
}

#adminPanel{
    display:none;
}

table{
    width:100%;
    border-collapse: collapse;
    margin-top:20px;
}

th, td{
    border:1px solid #ccc;
    padding:8px;
    text-align:center;
}

th{
    background:black;
    color:white;
}

tr:nth-child(even){
    background:#f9f9f9;
}

@media(max-width:600px){
    table, thead, tbody, th, td, tr{
        display:block;
    }
    tr{
        margin-bottom:15px;
    }
    td{
        text-align:left;
        position:relative;
        padding-left:50%;
    }
    td:before{
        position:absolute;
        left:10px;
        font-weight:bold;
        content: attr(data-label);
    }
}
</style>
</head>
<body>

<h2>Admin ‚Äì CAD ABVC</h2>

<!-- LOGIN -->
<form id="loginForm">
    <label>Email:</label>
    <input type="email" id="email" required>

    <label>Senha:</label>
    <input type="password" id="senha" required>

    <button type="button" onclick="login()">Entrar</button>
</form>

<!-- PAINEL ADMIN -->
<div id="adminPanel">
    <h2>Painel do Administrador</h2>

    <button onclick="carregarDispensas()">üìå Ver Dispensas</button>
    <button onclick="carregarRecibos()">üìÑ Ver Recibos</button>

    <div id="conteudoAdmin"></div>
</div>


<script>
// --------------------------------------------
// CONFIGURA√á√ÉO SUPABASE
// --------------------------------------------
const supabaseUrl = "https://prwhifyewscielsopluj.supabase.co";
const supabaseKey =
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InByd2hpZnlld3NjaWVsc29wbHVqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwMzA2MzEsImV4cCI6MjA3ODYwNjYzMX0.N8Op_2iUwRFd71YTninoztaInQtVLEnVIwbi2nIHkKg";

const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);


// --------------------------------------------
// LOGIN
// --------------------------------------------
async function login(){
    const email = document.getElementById("email").value;
    const senha = document.getElementById("senha").value;

    const { data, error } = await supabaseClient.auth.signInWithPassword({
        email: email,
        password: senha
    });

    if(error){
        alert("Erro no login: " + error.message);
        return;
    }

    document.getElementById("loginForm").style.display = "none";
    document.getElementById("adminPanel").style.display = "block";
}


// --------------------------------------------
// CARREGAR DISPENSAS
// --------------------------------------------
async function carregarDispensas(){
    const { data, error } = await supabaseClient.from("dispensas").select("*");

    if(error){
        alert("Erro ao carregar dispensas: " + error.message);
        return;
    }

    let html = `
    <h3>Dispensas</h3>
    <table>
        <tr>
            <th>Nome</th>
            <th>In√≠cio</th>
            <th>Fim</th>
            <th>Per√≠odo</th>
            <th>Motivo</th>
        </tr>`;

    data.forEach(d=>{
        html += `
        <tr>
            <td data-label="Nome">${d.nome}</td>
            <td data-label="In√≠cio">${d.data_inicio}</td>
            <td data-label="Fim">${d.data_fim}</td>
            <td data-label="Per√≠odo">${d.periodo}</td>
            <td data-label="Motivo">${d.motivo||""}</td>
        </tr>`;
    });

    html += `</table>`;

    document.getElementById("conteudoAdmin").innerHTML = html;
}


// --------------------------------------------
// CARREGAR RECIBOS
// --------------------------------------------
async function carregarRecibos(){
    const { data, error } = await supabaseClient.from("recibos").select("*");

    if(error){
        alert("Erro ao carregar recibos: " + error.message);
        return;
    }

    let html = `
    <h3>Recibos</h3>
    <table>
        <tr>
            <th>N¬∫ Jogo</th>
            <th>√Årbitros</th>
            <th>Ficheiro</th>
        </tr>`;

    data.forEach(r=>{
        html += `
        <tr>
            <td data-label="Jogo">${r.numero_jogo}</td>
            <td data-label="√Årbitros"><pre>${JSON.stringify(r.arbitros,null,2)}</pre></td>
            <td data-label="Ficheiro">
                ${r.ficheiro_url ? `<a href="${r.ficheiro_url}" target="_blank">Abrir</a>` : "‚Äî"}
            </td>
        </tr>`;
    });

    html += `</table>`;

    document.getElementById("conteudoAdmin").innerHTML = html;
}

</script>

</body>
</html>
